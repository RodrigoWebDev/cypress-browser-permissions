<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>cypress-browser-permissions</title>
	<meta name="description" content="Documentation for cypress-browser-permissions">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">cypress-browser-permissions</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="globals.html">Globals</a>
				</li>
			</ul>
			<h1>cypress-browser-permissions</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#cypress-browser-permissions" id="cypress-browser-permissions" style="color: inherit; text-decoration: none;">
					<h1>cypress-browser-permissions</h1>
				</a>
				<p><img src="https://img.shields.io/github/languages/code-size/kamranayub/cypress-browser-permissions.svg" alt="GitHub code size in bytes">
					<img src="https://img.shields.io/github/repo-size/kamranayub/cypress-browser-permissions.svg" alt="GitHub repo size">
					<img src="https://img.shields.io/npm/dw/cypress-browser-permissions.svg" alt="npm">
					<img src="https://img.shields.io/npm/dm/cypress-browser-permissions.svg" alt="npm">
					<img src="https://img.shields.io/npm/dy/cypress-browser-permissions.svg" alt="npm">
					<img src="https://img.shields.io/npm/dt/cypress-browser-permissions.svg" alt="npm">
					<img src="https://img.shields.io/npm/l/cypress-browser-permissions.svg" alt="NPM">
					<img src="https://img.shields.io/npm/v/cypress-browser-permissions.svg" alt="npm">
					<img src="https://img.shields.io/github/last-commit/kamranayub/cypress-browser-permissions.svg" alt="GitHub last commit">
				<img src="https://img.shields.io/npm/collaborators/cypress-browser-permissions.svg" alt="npm collaborators"></p>
				<p>A Cypress plugin to manage browser launch permissions for various APIs such as Notifications, Geolocation, Cookies, Images, and more.</p>
				<p><img src="https://user-images.githubusercontent.com/563819/87746293-d254c400-c7b5-11ea-9d22-d5613b9dae47.gif" alt="Video of notification being displayed"></p>
				<p>These APIs can be controlled using browser profile preferences which this plugin will generate and pass for you, as well as resetting them for each test run (otherwise they will be persisted).</p>
				<p>This enables you to effectively test permissions-based APIs in continuous integration environments and in headed browsers <em>without prompts.</em> :tada:</p>
				<a href="#usage" id="usage" style="color: inherit; text-decoration: none;">
					<h2>Usage</h2>
				</a>
				<blockquote>
					<p>:wave: Read the <a href="https://dev.to/kamranayub/controlling-browser-permissions-in-cypress-end-to-end-tests-5d7b">dev.to introduction post for a quick start guide and an example</a>!</p>
				</blockquote>
				<a href="#install-the-package" id="install-the-package" style="color: inherit; text-decoration: none;">
					<h3>Install the package</h3>
				</a>
				<a href="#npm" id="npm" style="color: inherit; text-decoration: none;">
					<h4>npm</h4>
				</a>
				<pre><code class="language-bash">npm i cypress-browser-permissions --save-dev</code></pre>
				<a href="#yarn" id="yarn" style="color: inherit; text-decoration: none;">
					<h4>yarn</h4>
				</a>
				<pre><code class="language-bash">yarn install cypress-browser-permissions --save-dev</code></pre>
				<a href="#import-and-initialize-the-plugin" id="import-and-initialize-the-plugin" style="color: inherit; text-decoration: none;">
					<h4>Import and initialize the plugin</h4>
				</a>
				<p>In <code>cypress/plugins/index.js</code>:</p>
				<p><strong>CommonJS</strong></p>
				<pre><code class="language-js"><span class="hljs-keyword">const</span> { cypressBrowserPermissionsPlugin } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;cypress-browser-permissions&#x27;</span>)

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function">(<span class="hljs-params">on, config</span>) =&gt;</span> {
  <span class="hljs-comment">// The plugin may modify the Cypress config, so be sure</span>
  <span class="hljs-comment">// to return it</span>
  config = cypressBrowserPermissionsPlugin(on, config)

  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Any existing plugins you are using</span>
  <span class="hljs-comment">//</span>

  <span class="hljs-keyword">return</span> config
}</code></pre>
				<p><strong>ES2015</strong></p>
				<pre><code class="language-js"><span class="hljs-keyword">import</span> { cypressBrowserPermissionsPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;cypress-browser-permissions&#x27;</span>

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function">(<span class="hljs-params">on, config</span>) =&gt;</span> {
  <span class="hljs-comment">// The plugin may modify the Cypress config, so be sure</span>
  <span class="hljs-comment">// to return it</span>
  config = cypressBrowserPermissionsPlugin(on, config)

  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Any existing plugins you are using</span>
  <span class="hljs-comment">//</span>

  <span class="hljs-keyword">return</span> config
}</code></pre>
				<a href="#setting-permissions" id="setting-permissions" style="color: inherit; text-decoration: none;">
					<h2>Setting Permissions</h2>
				</a>
				<p>Setting permissions should work in Chromium (Google Chrome, Microsoft Edge Chromium) and Firefox. They won&#39;t take effect in other browser families.</p>
				<p>Permissions cam be set using <a href="https://docs.cypress.io/guides/guides/environment-variables.html">Cypress environment variables</a>. The plugin reads permissions from <code>Cypress.env.browserPermissions</code> and supports all the existing ways to set Cypress environment variables.</p>
				<p><img src="https://user-images.githubusercontent.com/563819/87628826-63b13100-c6f7-11ea-956a-ca84a137d464.png" alt="Example of enabling permissions"></p>
				<a href="#in-cypressjson" id="in-cypressjson" style="color: inherit; text-decoration: none;">
					<h3>In <code>cypress.json</code></h3>
				</a>
				<p>In <code>cypress.json</code>, set the <code>env.browserPermissions</code> property with a map of permissions:</p>
				<pre><code class="language-json">{
  <span class="hljs-attr">&quot;env&quot;</span>: {
    <span class="hljs-attr">&quot;browserPermissions&quot;</span>: {
      <span class="hljs-attr">&quot;notifications&quot;</span>: <span class="hljs-string">&quot;allow&quot;</span>,
      <span class="hljs-attr">&quot;geolocation&quot;</span>: <span class="hljs-string">&quot;allow&quot;</span>,
      <span class="hljs-attr">&quot;camera&quot;</span>: <span class="hljs-string">&quot;block&quot;</span>,
      <span class="hljs-attr">&quot;microphone&quot;</span>: <span class="hljs-string">&quot;block&quot;</span>,
      <span class="hljs-attr">&quot;images&quot;</span>: <span class="hljs-string">&quot;allow&quot;</span>,
      <span class="hljs-attr">&quot;javascript&quot;</span>: <span class="hljs-string">&quot;allow&quot;</span>,
      <span class="hljs-attr">&quot;popups&quot;</span>: <span class="hljs-string">&quot;ask&quot;</span>,
      <span class="hljs-attr">&quot;plugins&quot;</span>: <span class="hljs-string">&quot;ask&quot;</span>,
      <span class="hljs-attr">&quot;cookies&quot;</span>: <span class="hljs-string">&quot;allow&quot;</span>
    }
  }
}</code></pre>
				<a href="#in-cypressenvjson" id="in-cypressenvjson" style="color: inherit; text-decoration: none;">
					<h3>In <code>cypress.env.json</code></h3>
				</a>
				<p>In <code>cypress.env.json</code>, it follows the same convention:</p>
				<pre><code class="language-json">{
  <span class="hljs-attr">&quot;browserPermissions&quot;</span>: {
    <span class="hljs-attr">&quot;notifications&quot;</span>: <span class="hljs-string">&quot;allow&quot;</span>,
    <span class="hljs-attr">&quot;geolocation&quot;</span>: <span class="hljs-string">&quot;allow&quot;</span>,
    <span class="hljs-attr">&quot;camera&quot;</span>: <span class="hljs-string">&quot;block&quot;</span>,
    <span class="hljs-attr">&quot;microphone&quot;</span>: <span class="hljs-string">&quot;block&quot;</span>,
    <span class="hljs-attr">&quot;images&quot;</span>: <span class="hljs-string">&quot;allow&quot;</span>,
    <span class="hljs-attr">&quot;javascript&quot;</span>: <span class="hljs-string">&quot;allow&quot;</span>,
    <span class="hljs-attr">&quot;popups&quot;</span>: <span class="hljs-string">&quot;ask&quot;</span>,
    <span class="hljs-attr">&quot;plugins&quot;</span>: <span class="hljs-string">&quot;ask&quot;</span>,
    <span class="hljs-attr">&quot;cookies&quot;</span>: <span class="hljs-string">&quot;allow&quot;</span>
  }
}</code></pre>
				<a href="#via-cypress-open-or-cypress-run" id="via-cypress-open-or-cypress-run" style="color: inherit; text-decoration: none;">
					<h3>Via <code>cypress open</code> or <code>cypress run</code></h3>
				</a>
				<p>Since the configuration is nested, you must pass in the permissions as a stringified JSON object:</p>
				<pre><code class="language-bash">$ cypress run  --env <span class="hljs-string">&#x27;{\&quot;browserPermissions\&quot;: {\&quot;notifications\&quot;: 1}}&#x27;</span>
$ cypress open --env <span class="hljs-string">&#x27;{\&quot;browserPermissions\&quot;: {\&quot;notifications\&quot;: 1}}&#x27;</span></code></pre>
				<a href="#via-machine-environment-variables" id="via-machine-environment-variables" style="color: inherit; text-decoration: none;">
					<h3>Via machine environment variables</h3>
				</a>
				<p>By default, Cypress cannot handle nested variable objects but this plugin will correctly find environment variables that match what it expects and will translate them properly for you automatically:</p>
				<pre><code class="language-bash">CYPRESS_browser_permissions_notifications=allow cypress run</code></pre>
				<blockquote>
					<p><strong>Remember:</strong> When passing Cypress env vars from the outside, such as from a script, prefix them with <code>CYPRESS_</code> e.g. <code>CYPRESS_browser_permissions_notifications=allow</code>. Cypress automatically strips the prefix when passing to <code>Cypress.env</code></p>
				</blockquote>
				<a href="#supported-permissions" id="supported-permissions" style="color: inherit; text-decoration: none;">
					<h3>Supported Permissions</h3>
				</a>
				<p>These are the supported permission names of the plugin:</p>
				<a href="#chrome--edge-chromium" id="chrome--edge-chromium" style="color: inherit; text-decoration: none;">
					<h4>Chrome / Edge (Chromium)</h4>
				</a>
				<ul>
					<li><code>notifications</code></li>
					<li><code>geolocation</code></li>
					<li><code>camera</code></li>
					<li><code>microphone</code></li>
					<li><code>images</code></li>
					<li><code>popups</code></li>
					<li><code>javascript</code></li>
					<li><code>cookies</code></li>
					<li><code>plugins</code></li>
				</ul>
				<a href="#firefox" id="firefox" style="color: inherit; text-decoration: none;">
					<h4>Firefox</h4>
				</a>
				<ul>
					<li><code>notifications</code></li>
					<li><code>geolocation</code></li>
					<li><code>camera</code></li>
					<li><code>microphone</code></li>
					<li><code>images</code></li>
				</ul>
				<a href="#supported-values" id="supported-values" style="color: inherit; text-decoration: none;">
					<h3>Supported Values</h3>
				</a>
				<p>Values for a permission can be any of the following:</p>
				<ul>
					<li><code>0</code> or <code>ask</code> - The default permission, which is to prompt the user</li>
					<li><code>1</code> or <code>allow</code> - Allow the permission</li>
					<li><code>2</code> or <code>block</code> - Block the permission</li>
				</ul>
				<a href="#api" id="api" style="color: inherit; text-decoration: none;">
					<h2>API</h2>
				</a>
				<p>In your Cypress test suites, you can import permissions helpers from the the package.</p>
				<a href="#usage-example" id="usage-example" style="color: inherit; text-decoration: none;">
					<h3>Usage Example</h3>
				</a>
				<p><strong>my-test.spec.js</strong></p>
				<pre><code class="language-js"><span class="hljs-keyword">import</span> { isPermissionAllowed, isPermissionBlocked, isPermissionAsk } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;cypress-browser-permissions&#x27;</span>

describe(<span class="hljs-string">&#x27;my site&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  before(<span class="hljs-function">() =&gt;</span> cy.visit(<span class="hljs-string">&#x27;/&#x27;</span>))

  isPermissionAllowed(<span class="hljs-string">&#x27;notifications&#x27;</span>) &amp;&amp;
    it(<span class="hljs-string">&#x27;should show desktop notification&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">/* ... */</span>
    })

  isPermissionBlocked(<span class="hljs-string">&#x27;notifications&#x27;</span>) &amp;&amp;
    it(<span class="hljs-string">&#x27;should warn user desktop notifications are disabled&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">/* ... */</span>
    })

  isPermissionAsk(<span class="hljs-string">&#x27;notifications&#x27;</span>) &amp;&amp;
    it(<span class="hljs-string">&#x27;should prompt user to allow desktop notifications&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">/* ... */</span>
    })
})</code></pre>
				<p>Also see <a href="cypress/integration">cypress/integration/</a> folder for e2e examples.</p>
				<a href="#docs" id="docs" style="color: inherit; text-decoration: none;">
					<h3>Docs</h3>
				</a>
				<p>See <a href="https://kamranicus.com/cypress-browser-permissions">API docs</a></p>
				<a href="#resetting-permissions" id="resetting-permissions" style="color: inherit; text-decoration: none;">
					<h2>Resetting Permissions</h2>
				</a>
				<p>This plugin automatically resets each supported permission to the browser default for each test run since otherwise profile preferences are persisted across sessions, which may not be what you intend.</p>
				<a href="#details" id="details" style="color: inherit; text-decoration: none;">
					<h2>Details</h2>
				</a>
				<a href="#how-it-works" id="how-it-works" style="color: inherit; text-decoration: none;">
					<h3>How It Works</h3>
				</a>
				<p>Cypress can pass <a href="https://docs.cypress.io/api/plugins/browser-launch-api.html#Modify-browser-launch-arguments-preferences-and-extensions">preferences</a> when launching browsers. This plugin adds a small abstraction over this low-level API to take care of setting the permission-related preferences in different browsers, mostly Chrome/Chromium and Firefox.</p>
				<p>You can listen to the <code>before:browser:launch</code> event in your own Cypress application to add any additional preferences.</p>
				<a href="#chrome--edge--chromium-preferences" id="chrome--edge--chromium-preferences" style="color: inherit; text-decoration: none;">
					<h3>Chrome / Edge / Chromium Preferences</h3>
				</a>
				<p>Documented in <a href="https://src.chromium.org/viewvc/chrome/trunk/src/chrome/common/pref_names.cc?view=markup">pref_names</a>, the permission-related preferences are grouped under <code>profile.managed_default_content_settings</code>.</p>
				<p>These modify the &quot;managed&quot; settings, such as when group policy is enforced. In the Chrome settings, there <em>is</em> a way to add specific sites to allow / block lists, and this may be possible to do with the plugin if that is stored in the profile data structure.</p>
				<a href="#firefox-1" id="firefox-1" style="color: inherit; text-decoration: none;">
					<h3>Firefox</h3>
				</a>
				<p>In <code>about:config</code> within Firefox, search for <code>permissions.default</code> to list permissions.</p>
				<p>Notably, Firefox does not have some permissions related to JavaScript, Cookies, Plugins, and Popups but those may be managed with other settings.</p>
				<a href="#credits" id="credits" style="color: inherit; text-decoration: none;">
					<h2>Credits</h2>
				</a>
				<p>Thanks to BrowserStack for <a href="https://www.browserstack.com/automate/handle-popups-alerts-prompts-in-automated-tests">documenting some of these permissions</a> as well as these StackOverflow posts:</p>
				<ul>
					<li><a href="https://stackoverflow.com/questions/55435198/selenium-python-allow-firefox-notifications">Selenium + Python Allow Firefox Notifications</a></li>
					<li><a href="https://stackoverflow.com/questions/48007699/how-to-allow-or-deny-notification-geo-location-microphone-camera-pop-up">How to allow or deny notification geo-location microphone camera pop up</a></li>
				</ul>
				<p>In Web Driver testing, these are passed under capabilities, such as <a href="https://webdriver.io/docs/configurationfile.html">shown in the test-runner configuration</a> and then passing as <a href="https://stackoverflow.com/a/47654122/109458">shown here</a>.</p>
				<a href="#mit-license" id="mit-license" style="color: inherit; text-decoration: none;">
					<h2>MIT License</h2>
				</a>
				<p>See <a href="LICENSE">LICENSE</a></p>
				<pre><code></code></pre>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="globals  ">
						<a href="globals.html"><em>Globals</em></a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_constants_.html">&quot;constants&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_helpers_.html">&quot;helpers&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_index_.html">&quot;index&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_plugin_.html">&quot;plugin&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_types_.html">&quot;types&quot;</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-object-literal"><span class="tsd-kind-icon">Object literal</span></li>
				<li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li>
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
				<li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-enum"><span class="tsd-kind-icon">Enumeration</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>